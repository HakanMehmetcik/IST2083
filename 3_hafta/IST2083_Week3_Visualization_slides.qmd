---
title: "3. Hafta: Veri GÃ¶rselleÅŸtirme ve ggplot"
author: "Hakan Mehmetcik"
date: "`r Sys.Date()`"
format:
  revealjs:
    theme: simple
    slide-number: true
    toc: true
    toc-depth: 2
    incremental: true
    code-overflow: wrap
    code-line-numbers: false
    embed-resources: false
    self-contained: false
editor: visual
execute:
  echo: true
  warning: false
  message: false
lang: tr
---

```{r setup}
#| include: false
library(tidyverse)
library(ggplot2)
library(mosaicData)
library(mdsr)
# library(fec16)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 14))
dpath <- "~/Desktop/IST2083/Data"
```

# ğŸ¯ Ã–ÄŸrenme Hedefleri

-   Base R ve ggplot2 ile temel ve geliÅŸmiÅŸ grafikler Ã¼retmek
-   Estetikler, Ã¶lÃ§ekler, koordinatlar, baÄŸlam ve katman mantÄ±ÄŸÄ±nÄ± uygulamak
-   Facet ve renk/eriÅŸilebilirlik ilkeleriyle Ã§ok deÄŸiÅŸkenli gÃ¶rselleÅŸtirme yapmak

------------------------------------------------------------------------

# Neden GÃ¶rselleÅŸtirme?

> Nathan Yau (2013): Komut yazmak â‰  iyi gÃ¶rselleÅŸtirme. FarkÄ± yaratan **ustalÄ±k, malzeme bilgisi, iÃ§gÃ¶rÃ¼**.

-   Bulgu iletiÅŸimi ve veri kontrolÃ¼
-   AykÄ±rÄ± deÄŸer/kalite sorunlarÄ±nÄ± fark etme
-   AnlatÄ± (storytelling) ve ikna

------------------------------------------------------------------------

# Base R ile hÄ±zlÄ± baÅŸlangÄ±Ã§

## Basit daÄŸÄ±lÄ±m

```{r}
x <- c(1,2,3,4,5); y <- c(2,3,5,4,6)
plot(x, y, main = "DaÄŸÄ±lÄ±m", xlab = "X", ylab = "Y", pch = 19)
```

## type / stil Ã¶rneÄŸi

```{r}
plot(x, y, type = "o", col = "steelblue", pch = 19, cex = 1.3, lty = 2, lwd = 2, las = 1)
```

------------------------------------------------------------------------

# ggplot2: Grafiklerin Grameri

```{r}
ggplot(tibble(x,y), aes(x, y)) +
  geom_line(linetype = "dashed", linewidth = 1) +
  geom_point(size = 3) +
  labs(title = "Ä°lk ggplot", x = "X", y = "Y")
```

**BeÅŸ unsur:** Estetikler Â· Geometriler Â· Koordinatlar Â· Ã–lÃ§ekler Â· BaÄŸlam

------------------------------------------------------------------------

## SÄ±k kullanÄ±lan estetikler

| Estetik    | Veri         | AÃ§Ä±klama           |
|------------|--------------|--------------------|
| x, y       | Kat./SayÄ±sal | Eksen deÄŸiÅŸkenleri |
| color/fill | Kat./SayÄ±sal | Kenar / iÃ§ renk    |
| size       | SayÄ±sal      | Boyut              |
| shape      | Kategorik    | Nokta ÅŸekli        |
| linetype   | Kategorik    | Ã‡izgi tÃ¼rÃ¼         |
| alpha      | SayÄ±sal      | SaydamlÄ±k          |

*Not:* Ã‡ok kategori varsa **facet** veya **renk** tercih edin; `shape` sÄ±nÄ±rlÄ± kategori destekler.

------------------------------------------------------------------------

# Global vs. yerel estetikler

```{r}
set.seed(42)
students <- tibble(
  Name = paste("Ã–ÄŸrenci", 1:30),
  Math = sample(60:100, 30, TRUE),
  Science = sample(60:100, 30, TRUE),
  Gender = sample(c("KÄ±z","Erkek"), 30, TRUE)
)

# Global estetik
ggplot(students, aes(Math, Science, color = Gender)) +
  geom_point(size = 3) +
  labs(title = "Global estetik (color=Gender)")
```

```{r}
# Yerel estetik
ggplot(students, aes(Name, Science)) +
  geom_col(aes(fill = Gender)) +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1)) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Yerel estetik (fill=Gender)")
```

------------------------------------------------------------------------

# Facet, katman ve yaÅŸ gruplarÄ±

```{r}
set.seed(42)
students <- tibble(
  Name = paste("Ã–ÄŸrenci", 1:50),
  Math = sample(60:100, 50, TRUE),
  Science = sample(60:100, 50, TRUE),
  Gender = sample(c("KÄ±z","Erkek"), 50, TRUE),
  Age = sample(15:20, 50, TRUE),
  Course = sample(c("Matematik","Fen","Kimya"), 50, TRUE)
)

ggplot(students, aes(Math, Science)) +
  geom_point(aes(color = Gender, size = Science), alpha = .8) +
  scale_color_brewer(palette = "Set1") +
  facet_wrap(~ Gender) +
  labs(title = "Facet ile karÅŸÄ±laÅŸtÄ±rma", x = "Matematik", y = "Fen")
```

```{r}
students2 <- students %>%
  mutate(AgeGroup = case_when(
    Age < 17 ~ "15-16",
    Age < 18 ~ "17",
    Age < 19 ~ "18",
    TRUE ~ "19-20"
  ))

ggplot(students2, aes(Math, Science)) +
  geom_point(alpha = .8) +
  facet_wrap(~ AgeGroup) +
  labs(title = "YaÅŸ gruplarÄ±na gÃ¶re facet")
```

------------------------------------------------------------------------

# CIACountries ile Ã§ok deÄŸiÅŸkenli Ã¶rnek

```{r}
data("CIACountries")
CIACountries %>%
  ggplot(aes(gdp, pop)) +
  geom_point(aes(color = educ, size = net_users), alpha = .7) +
  scale_color_distiller(palette = "PuBuGn", direction = 1) +
  labs(title = "NÃ¼fus ~ GSYÄ°H", x = "GSYÄ°H", y = "NÃ¼fus",
       color = "% EÄŸitim", size = "Ä°nternet")
```

------------------------------------------------------------------------

## Koordinatlar ve Ã¶lÃ§ekler

```{r}
CIACountries %>%
  filter(!is.na(roadways)) %>%
  arrange(desc(roadways)) %>%
  slice_head(n = 30) %>%
  ggplot(aes(x = reorder(country, roadways), y = roadways)) +
  geom_col(aes(fill = factor(net_users))) +
  scale_fill_brewer(palette = "YlGnBu", name = "Ä°nternet (%)") +
  coord_flip() +
  labs(title = "Yol yoÄŸunluÄŸu (ilk 30)", x = NULL, y = "Yol/Alan")
```

------------------------------------------------------------------------

# Tek deÄŸiÅŸkenli: SAT_2010

```{r}
data("SAT_2010")
ggplot(SAT_2010, aes(math)) +
  geom_histogram(binwidth = 10, fill = "lightblue", color = "black") +
  labs(title = "Matematik puanlarÄ±: histogram")
```

```{r}
ggplot(SAT_2010, aes(math)) +
  geom_density(fill = "lightblue", alpha = .5) +
  labs(title = "Matematik puanlarÄ±: yoÄŸunluk")
```

```{r}
ggplot(SAT_2010, aes(y = math)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Matematik puanlarÄ±: kutu grafiÄŸi", y = "Math")
```

------------------------------------------------------------------------

# Ä°ki sayÄ±sal deÄŸiÅŸken: Trend Ã§izgisi

```{r}
ggplot(SAT_2010, aes(expenditure, math)) +
  geom_point(size = 3, alpha = .7) +
  geom_smooth(method = "lm", se = FALSE, color = "firebrick") +
  labs(title = "Harcama ~ Matematik", x = "Ã–ÄŸrenci BaÅŸÄ±na Harcama", y = "Math")
```

```{r}
SAT_2010_rate <- SAT_2010 %>%
  mutate(SAT_rate = case_when(
    sat_pct >= 70 ~ "YÃ¼ksek",
    sat_pct >= 40 ~ "Orta",
    TRUE ~ "DÃ¼ÅŸÃ¼k"
  ))

ggplot(SAT_2010_rate, aes(expenditure, math, color = SAT_rate)) +
  geom_point(alpha = .8) +
  geom_smooth(method = "lm", se = FALSE, color = "gray25") +
  facet_wrap(~ SAT_rate) +
  scale_color_brewer(palette = "Dark2", name = "SAT %") +
  labs(title = "Harcama ~ Matematik (facet)")
```

------------------------------------------------------------------------

# Ä°ki kategorik deÄŸiÅŸken

```{r}
ggplot(mosaicData::HELPrct, aes(x = homeless)) +
  geom_bar(aes(fill = substance), position = "fill") +
  scale_fill_brewer(palette = "Spectral") +
  coord_flip() +
  labs(title = "Evsizlik ~ madde (oran)", y = "Oran", x = NULL)
```

------------------------------------------------------------------------

# Zaman serisi (opsiyonel)

```{r}
# library(macleish); library(NHANES); library(forcats)
# whately_2015 %>% ggplot(aes(when, temperature)) + geom_line() + geom_smooth(se = FALSE)
```

------------------------------------------------------------------------

# Hangi soruna hangi grafik? (Ã¶zet)

| y       | x       | Grafik        | geom\_\*                    | Not          |
|---------|---------|---------------|-----------------------------|--------------|
| Kat.    | Kat.    | Ã‡ubuk         | `geom_bar()`                | Frekans      |
| Kat.    | Kat.    | YÄ±ÄŸÄ±lmÄ±ÅŸ oran | `geom_bar(position="fill")` | Oran         |
| SayÄ±sal | Kat.    | Kutu          | `geom_boxplot()`            | Medyan & IQR |
| SayÄ±sal | SayÄ±sal | DaÄŸÄ±lÄ±m       | `geom_point()`              | Ä°liÅŸki       |
| SayÄ±sal | â€”       | Histogram     | `geom_histogram()`          | Binwidth     |
| SayÄ±sal | â€”       | YoÄŸunluk      | `geom_density()`            | PÃ¼rÃ¼zsÃ¼zlÃ¼k  |
| SayÄ±sal | Zaman   | Ã‡izgi         | `geom_line()`               | Trend        |

------------------------------------------------------------------------

# EriÅŸilebilirlik (renk)

-   KÄ±rmÄ±zÄ±â€“yeÅŸil karÅŸÄ±tlÄ±ÄŸÄ±ndan kaÃ§Ä±nÄ±n (â‰ˆ%8 renk kÃ¶rlÃ¼ÄŸÃ¼)\n- `scale_*_brewer()` veya `viridis` kullanÄ±n\n- GerekmedikÃ§e az renk, net mesaj

------------------------------------------------------------------------

# AlÄ±ÅŸtÄ±rmalar

1.  `SAT_2010` ile **reading** iÃ§in histogram Ã§izin; farklÄ± `binwidth` deneyin.\
2.  `CIACountries` ile **gdp \~ net_users** iÃ§in `geom_point()` + `geom_smooth()` ve `scale_x_log10()` deneyin.\
3.  `HELPrct` veriyle **homeless** durumuna gÃ¶re **age** daÄŸÄ±lÄ±mÄ±nÄ± kutu grafiÄŸi ile karÅŸÄ±laÅŸtÄ±rÄ±n.

------------------------------------------------------------------------

# TeÅŸekkÃ¼rler

Sorular?
