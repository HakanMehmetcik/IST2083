---
title: "3. Hafta: Veri Görselleştirme ve ggplot"
author: "Hakan Mehmetcik"
date: "`r Sys.Date()`"
format:
  revealjs:
    theme: simple
    slide-number: true
    toc: true
    toc-depth: 2
    incremental: true
    code-overflow: wrap
    code-line-numbers: false
    embed-resources: false
    self-contained: false
editor: visual
execute:
  echo: true
  warning: false
  message: false
lang: tr
---

```{r setup}
#| include: false
library(tidyverse)
library(ggplot2)
library(mosaicData)
library(mdsr)
# library(fec16)
library(RColorBrewer)
theme_set(theme_minimal(base_size = 14))
dpath <- "~/Desktop/IST2083/Data"
```

# 🎯 Öğrenme Hedefleri

-   Base R ve ggplot2 ile temel ve gelişmiş grafikler üretmek
-   Estetikler, ölçekler, koordinatlar, bağlam ve katman mantığını uygulamak
-   Facet ve renk/erişilebilirlik ilkeleriyle çok değişkenli görselleştirme yapmak

------------------------------------------------------------------------

# Neden Görselleştirme?

> Nathan Yau (2013): Komut yazmak ≠ iyi görselleştirme. Farkı yaratan **ustalık, malzeme bilgisi, içgörü**.

-   Bulgu iletişimi ve veri kontrolü
-   Aykırı değer/kalite sorunlarını fark etme
-   Anlatı (storytelling) ve ikna

------------------------------------------------------------------------

# Base R ile hızlı başlangıç

## Basit dağılım

```{r}
x <- c(1,2,3,4,5); y <- c(2,3,5,4,6)
plot(x, y, main = "Dağılım", xlab = "X", ylab = "Y", pch = 19)
```

## type / stil örneği

```{r}
plot(x, y, type = "o", col = "steelblue", pch = 19, cex = 1.3, lty = 2, lwd = 2, las = 1)
```

------------------------------------------------------------------------

# ggplot2: Grafiklerin Grameri

```{r}
ggplot(tibble(x,y), aes(x, y)) +
  geom_line(linetype = "dashed", linewidth = 1) +
  geom_point(size = 3) +
  labs(title = "İlk ggplot", x = "X", y = "Y")
```

**Beş unsur:** Estetikler · Geometriler · Koordinatlar · Ölçekler · Bağlam

------------------------------------------------------------------------

## Sık kullanılan estetikler

| Estetik    | Veri         | Açıklama           |
|------------|--------------|--------------------|
| x, y       | Kat./Sayısal | Eksen değişkenleri |
| color/fill | Kat./Sayısal | Kenar / iç renk    |
| size       | Sayısal      | Boyut              |
| shape      | Kategorik    | Nokta şekli        |
| linetype   | Kategorik    | Çizgi türü         |
| alpha      | Sayısal      | Saydamlık          |

*Not:* Çok kategori varsa **facet** veya **renk** tercih edin; `shape` sınırlı kategori destekler.

------------------------------------------------------------------------

# Global vs. yerel estetikler

```{r}
set.seed(42)
students <- tibble(
  Name = paste("Öğrenci", 1:30),
  Math = sample(60:100, 30, TRUE),
  Science = sample(60:100, 30, TRUE),
  Gender = sample(c("Kız","Erkek"), 30, TRUE)
)

# Global estetik
ggplot(students, aes(Math, Science, color = Gender)) +
  geom_point(size = 3) +
  labs(title = "Global estetik (color=Gender)")
```

```{r}
# Yerel estetik
ggplot(students, aes(Name, Science)) +
  geom_col(aes(fill = Gender)) +
  theme(axis.text.x = element_text(angle = 90, vjust = .5, hjust = 1)) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Yerel estetik (fill=Gender)")
```

------------------------------------------------------------------------

# Facet, katman ve yaş grupları

```{r}
set.seed(42)
students <- tibble(
  Name = paste("Öğrenci", 1:50),
  Math = sample(60:100, 50, TRUE),
  Science = sample(60:100, 50, TRUE),
  Gender = sample(c("Kız","Erkek"), 50, TRUE),
  Age = sample(15:20, 50, TRUE),
  Course = sample(c("Matematik","Fen","Kimya"), 50, TRUE)
)

ggplot(students, aes(Math, Science)) +
  geom_point(aes(color = Gender, size = Science), alpha = .8) +
  scale_color_brewer(palette = "Set1") +
  facet_wrap(~ Gender) +
  labs(title = "Facet ile karşılaştırma", x = "Matematik", y = "Fen")
```

```{r}
students2 <- students %>%
  mutate(AgeGroup = case_when(
    Age < 17 ~ "15-16",
    Age < 18 ~ "17",
    Age < 19 ~ "18",
    TRUE ~ "19-20"
  ))

ggplot(students2, aes(Math, Science)) +
  geom_point(alpha = .8) +
  facet_wrap(~ AgeGroup) +
  labs(title = "Yaş gruplarına göre facet")
```

------------------------------------------------------------------------

# CIACountries ile çok değişkenli örnek

```{r}
data("CIACountries")
CIACountries %>%
  ggplot(aes(gdp, pop)) +
  geom_point(aes(color = educ, size = net_users), alpha = .7) +
  scale_color_distiller(palette = "PuBuGn", direction = 1) +
  labs(title = "Nüfus ~ GSYİH", x = "GSYİH", y = "Nüfus",
       color = "% Eğitim", size = "İnternet")
```

------------------------------------------------------------------------

## Koordinatlar ve ölçekler

```{r}
CIACountries %>%
  filter(!is.na(roadways)) %>%
  arrange(desc(roadways)) %>%
  slice_head(n = 30) %>%
  ggplot(aes(x = reorder(country, roadways), y = roadways)) +
  geom_col(aes(fill = factor(net_users))) +
  scale_fill_brewer(palette = "YlGnBu", name = "İnternet (%)") +
  coord_flip() +
  labs(title = "Yol yoğunluğu (ilk 30)", x = NULL, y = "Yol/Alan")
```

------------------------------------------------------------------------

# Tek değişkenli: SAT_2010

```{r}
data("SAT_2010")
ggplot(SAT_2010, aes(math)) +
  geom_histogram(binwidth = 10, fill = "lightblue", color = "black") +
  labs(title = "Matematik puanları: histogram")
```

```{r}
ggplot(SAT_2010, aes(math)) +
  geom_density(fill = "lightblue", alpha = .5) +
  labs(title = "Matematik puanları: yoğunluk")
```

```{r}
ggplot(SAT_2010, aes(y = math)) +
  geom_boxplot(fill = "lightgreen") +
  labs(title = "Matematik puanları: kutu grafiği", y = "Math")
```

------------------------------------------------------------------------

# İki sayısal değişken: Trend çizgisi

```{r}
ggplot(SAT_2010, aes(expenditure, math)) +
  geom_point(size = 3, alpha = .7) +
  geom_smooth(method = "lm", se = FALSE, color = "firebrick") +
  labs(title = "Harcama ~ Matematik", x = "Öğrenci Başına Harcama", y = "Math")
```

```{r}
SAT_2010_rate <- SAT_2010 %>%
  mutate(SAT_rate = case_when(
    sat_pct >= 70 ~ "Yüksek",
    sat_pct >= 40 ~ "Orta",
    TRUE ~ "Düşük"
  ))

ggplot(SAT_2010_rate, aes(expenditure, math, color = SAT_rate)) +
  geom_point(alpha = .8) +
  geom_smooth(method = "lm", se = FALSE, color = "gray25") +
  facet_wrap(~ SAT_rate) +
  scale_color_brewer(palette = "Dark2", name = "SAT %") +
  labs(title = "Harcama ~ Matematik (facet)")
```

------------------------------------------------------------------------

# İki kategorik değişken

```{r}
ggplot(mosaicData::HELPrct, aes(x = homeless)) +
  geom_bar(aes(fill = substance), position = "fill") +
  scale_fill_brewer(palette = "Spectral") +
  coord_flip() +
  labs(title = "Evsizlik ~ madde (oran)", y = "Oran", x = NULL)
```

------------------------------------------------------------------------

# Zaman serisi (opsiyonel)

```{r}
# library(macleish); library(NHANES); library(forcats)
# whately_2015 %>% ggplot(aes(when, temperature)) + geom_line() + geom_smooth(se = FALSE)
```

------------------------------------------------------------------------

# Hangi soruna hangi grafik? (özet)

| y       | x       | Grafik        | geom\_\*                    | Not          |
|---------|---------|---------------|-----------------------------|--------------|
| Kat.    | Kat.    | Çubuk         | `geom_bar()`                | Frekans      |
| Kat.    | Kat.    | Yığılmış oran | `geom_bar(position="fill")` | Oran         |
| Sayısal | Kat.    | Kutu          | `geom_boxplot()`            | Medyan & IQR |
| Sayısal | Sayısal | Dağılım       | `geom_point()`              | İlişki       |
| Sayısal | —       | Histogram     | `geom_histogram()`          | Binwidth     |
| Sayısal | —       | Yoğunluk      | `geom_density()`            | Pürüzsüzlük  |
| Sayısal | Zaman   | Çizgi         | `geom_line()`               | Trend        |

------------------------------------------------------------------------

# Erişilebilirlik (renk)

-   Kırmızı–yeşil karşıtlığından kaçının (≈%8 renk körlüğü)\n- `scale_*_brewer()` veya `viridis` kullanın\n- Gerekmedikçe az renk, net mesaj

------------------------------------------------------------------------

# Alıştırmalar

1.  `SAT_2010` ile **reading** için histogram çizin; farklı `binwidth` deneyin.\
2.  `CIACountries` ile **gdp \~ net_users** için `geom_point()` + `geom_smooth()` ve `scale_x_log10()` deneyin.\
3.  `HELPrct` veriyle **homeless** durumuna göre **age** dağılımını kutu grafiği ile karşılaştırın.

------------------------------------------------------------------------

# Teşekkürler

Sorular?
